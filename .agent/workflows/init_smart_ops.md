---
description: Initialize Smart Ops for this repository (Global Generator)
---
# Workflow: Initialize Smart Ops

This workflow bootstraps the **Smart Start** and **Smart Complete** workflows for the current repository.
It generates a **universal shell script** that works with ANY stack (Node, Python, Rust, Go, etc.).

## Steps

### 1. Detect Repository Context
The agent should verify the current repository details.
```bash
gh repo view --json owner,name,url
```

### 2. Fetch Project Board IDs (If Using GitHub Projects)
Get the Project Board IDs for reliable automation.
```bash
gh project list --owner {{OWNER}} --format json
gh project field-list {{PROJECT_NUMBER}} --owner {{OWNER}} --format json
```

**Look for these field types in the output:**
- `STATUS` â€” Single select field (Todo, In Progress, Done)
- `START_DATE` â€” Date field for when work started
- `TARGET_DATE` or `DUE_DATE` â€” Date field for deadline
- `ITERATION` â€” Iteration/Sprint field

> [!TIP]
> If the project doesn't use GitHub Projects, skip Step 2. The script will still work for issues.
> To enable timeline tracking, create these fields in your GitHub Project:
> - "Start Date" (Date type)
> - "Target Date" (Date type)

### 3. Generate `scripts/smart-ops.sh` (Universal)

Create a universal shell script that works for ANY project stack.

**Location:** `scripts/smart-ops.sh` (or `.scripts/smart-ops.sh` for hidden)

```bash
#!/bin/bash
# Smart Ops - GitHub Automation Script
# Generated by /init_smart_ops workflow
# Works with ANY project stack (Node, Python, Rust, Go, etc.)
# Includes timeline/duration tracking

set -e

# ============ CONFIGURATION ============
REPO_OWNER="{{OWNER}}"
REPO_NAME="{{REPO}}"
REPO="${REPO_OWNER}/${REPO_NAME}"

# GitHub Project Board IDs (optional - leave empty if not using Projects)
PROJECT_NUMBER="{{PROJECT_NUMBER}}"
PROJECT_ID="{{PROJECT_ID}}"
STATUS_FIELD_ID="{{STATUS_FIELD_ID}}"
TODO_OPTION_ID="{{TODO_OPTION_ID}}"
IN_PROGRESS_OPTION_ID="{{IN_PROGRESS_OPTION_ID}}"
DONE_OPTION_ID="{{DONE_OPTION_ID}}"

# Date/Timeline Field IDs (optional - for tracking duration)
START_DATE_FIELD_ID="{{START_DATE_FIELD_ID}}"
TARGET_DATE_FIELD_ID="{{TARGET_DATE_FIELD_ID}}"

# ============ HELPER FUNCTIONS ============

get_today() {
    date +%Y-%m-%d
}

get_future_date() {
    # Usage: get_future_date 7 (7 days from now)
    local days="${1:-7}"
    if [[ "$OSTYPE" == "darwin"* ]]; then
        date -v+${days}d +%Y-%m-%d
    else
        date -d "+${days} days" +%Y-%m-%d
    fi
}

# ============ CORE FUNCTIONS ============

start() {
    echo "ðŸ” Scanning active work..."
    echo ""
    echo "=== Open Issues ==="
    gh issue list --repo "$REPO" --state open --json number,title,labels,createdAt --limit 20
    echo ""
    
    if [ -n "$PROJECT_NUMBER" ]; then
        echo "=== Project Board Items ==="
        gh project item-list "$PROJECT_NUMBER" --owner "$REPO_OWNER" --format json --limit 20 2>/dev/null || echo "No project board configured"
    fi
}

complete() {
    echo "ðŸ“‹ Checking active work for completion..."
    echo ""
    echo "=== In-Progress Issues ==="
    gh issue list --repo "$REPO" --state open --json number,title,labels,createdAt --limit 20
    echo ""
    echo "Today's date: $(get_today)"
    echo ""
    echo "Use './smart-ops.sh close <number>' to close completed issues."
}

create_issue() {
    # Usage: ./smart-ops.sh create "Title" "Body" "labels" [days_estimate]
    local title="$1"
    local body="$2"
    local labels="${3:-enhancement}"
    local days_estimate="${4:-7}"
    
    echo "ðŸ“ Creating issue: $title"
    echo "   Estimated duration: $days_estimate days"
    
    # Create the issue
    local issue_url=$(gh issue create --repo "$REPO" --title "$title" --body "$body" --label "$labels")
    local issue_num=$(echo "$issue_url" | grep -oE '[0-9]+$')
    
    echo "   Created issue #$issue_num"
    
    # If project board is configured, add to board with dates
    if [ -n "$PROJECT_ID" ] && [ -n "$issue_num" ]; then
        echo "   Adding to project board..."
        local item_id=$(gh project item-add "$PROJECT_NUMBER" --owner "$REPO_OWNER" --url "$issue_url" --format json | jq -r '.id')
        
        # Set start date to today
        if [ -n "$START_DATE_FIELD_ID" ]; then
            gh project item-edit --id "$item_id" --project-id "$PROJECT_ID" --field-id "$START_DATE_FIELD_ID" --date "$(get_today)" 2>/dev/null || true
            echo "   Start date: $(get_today)"
        fi
        
        # Set target date based on estimate
        if [ -n "$TARGET_DATE_FIELD_ID" ]; then
            local target=$(get_future_date "$days_estimate")
            gh project item-edit --id "$item_id" --project-id "$PROJECT_ID" --field-id "$TARGET_DATE_FIELD_ID" --date "$target" 2>/dev/null || true
            echo "   Target date: $target"
        fi
        
        echo "   âœ… Added to project with timeline"
    fi
    
    echo "$issue_url"
}

close_issue() {
    # Usage: ./smart-ops.sh close <issue_number> ["comment"]
    local issue_num="$1"
    local comment="${2:-Completed via Smart Complete on $(get_today)}"
    
    echo "âœ… Closing issue #$issue_num"
    echo "   Completion date: $(get_today)"
    
    gh issue close "$issue_num" --repo "$REPO" --comment "$comment"
    
    echo "   Issue #$issue_num closed"
}

set_target_date() {
    # Usage: ./smart-ops.sh target <item_id> <YYYY-MM-DD or days>
    if [ -z "$TARGET_DATE_FIELD_ID" ]; then
        echo "No target date field configured"
        return 1
    fi
    
    local item_id="$1"
    local date_input="$2"
    
    # If input is a number, treat as days from now
    if [[ "$date_input" =~ ^[0-9]+$ ]]; then
        date_input=$(get_future_date "$date_input")
    fi
    
    gh project item-edit --id "$item_id" --project-id "$PROJECT_ID" --field-id "$TARGET_DATE_FIELD_ID" --date "$date_input"
    echo "ðŸ“… Target date set to: $date_input"
}

set_start_date() {
    # Usage: ./smart-ops.sh started <item_id> [YYYY-MM-DD]
    if [ -z "$START_DATE_FIELD_ID" ]; then
        echo "No start date field configured"
        return 1
    fi
    
    local item_id="$1"
    local date_input="${2:-$(get_today)}"
    
    gh project item-edit --id "$item_id" --project-id "$PROJECT_ID" --field-id "$START_DATE_FIELD_ID" --date "$date_input"
    echo "ðŸš€ Start date set to: $date_input"
}

move_to_in_progress() {
    # Usage: ./smart-ops.sh progress <item_id>
    if [ -z "$PROJECT_ID" ]; then
        echo "No project board configured"
        return 1
    fi
    local item_id="$1"
    
    # Set status to In Progress
    gh project item-edit --id "$item_id" --field-id "$STATUS_FIELD_ID" --project-id "$PROJECT_ID" --single-select-option-id "$IN_PROGRESS_OPTION_ID"
    
    # Also set start date to today if not already set
    if [ -n "$START_DATE_FIELD_ID" ]; then
        gh project item-edit --id "$item_id" --project-id "$PROJECT_ID" --field-id "$START_DATE_FIELD_ID" --date "$(get_today)" 2>/dev/null || true
    fi
    
    echo "ðŸ”„ Moved to In Progress (started: $(get_today))"
}

move_to_done() {
    # Usage: ./smart-ops.sh done <item_id>
    if [ -z "$PROJECT_ID" ]; then
        echo "No project board configured"
        return 1
    fi
    local item_id="$1"
    gh project item-edit --id "$item_id" --field-id "$STATUS_FIELD_ID" --project-id "$PROJECT_ID" --single-select-option-id "$DONE_OPTION_ID"
    echo "âœ… Moved to Done (completed: $(get_today))"
}

# ============ MAIN ============
case "${1:-help}" in
    start)
        start
        ;;
    complete)
        complete
        ;;
    create)
        create_issue "$2" "$3" "$4" "$5"
        ;;
    close)
        close_issue "$2" "$3"
        ;;
    progress)
        move_to_in_progress "$2"
        ;;
    done)
        move_to_done "$2"
        ;;
    target)
        set_target_date "$2" "$3"
        ;;
    started)
        set_start_date "$2" "$3"
        ;;
    *)
        echo "Smart Ops - GitHub Automation with Timeline Tracking"
        echo ""
        echo "Usage: ./smart-ops.sh <command>"
        echo ""
        echo "Issue Commands:"
        echo "  start              - List open issues and project items"
        echo "  complete           - List issues ready for completion"
        echo "  create             - Create issue: create \"Title\" \"Body\" \"labels\" [days]"
        echo "  close              - Close issue: close <number> \"comment\""
        echo ""
        echo "Project Board Commands:"
        echo "  progress           - Move to In Progress: progress <item_id>"
        echo "  done               - Move to Done: done <item_id>"
        echo ""
        echo "Timeline Commands:"
        echo "  target             - Set target date: target <item_id> <YYYY-MM-DD or days>"
        echo "  started            - Set start date: started <item_id> [YYYY-MM-DD]"
        echo ""
        echo "Examples:"
        echo "  ./smart-ops.sh create \"Fix login bug\" \"Description here\" \"bug\" 3"
        echo "  ./smart-ops.sh target abc123 7     # Due in 7 days"
        echo "  ./smart-ops.sh target abc123 2024-12-20"
        ;;
esac
```

**Make it executable:**
```bash
chmod +x scripts/smart-ops.sh
```


### 4. Generate Local Workflows

**A. Create `.agent/workflows/smart_start.md`:**

```markdown
---
description: Intelligent start-of-work workflow that auto-detects context and creates appropriate issues
---
// turbo-all

# Workflow: Smart Start (Intelligent)

## Usage
User: "Use /smart_start. I want to work on [describe what you're doing]."

## Agent Steps

### 1. Scan Work (Scripted)
./scripts/smart-ops.sh start

### 2. Analyze User Intent
Match user's intent to existing issue/draft, or create NEW.

**If NEW, use the Professional Issue Template:**

## Title
[Feature/Bug] Clear, concise summary

## Labels
enhancement, [module-name]

## User Story
As a [user type], I want to [action], so that [benefit].

## Root Cause / Proposed Solution
*(This is the "Plan-and-Solve" part â€” critical for actionable issues)*

**For Features:** Describe the implementation approach:
- Key components/files to create or modify
- Data flow and architecture decisions
- Dependencies or prerequisites

**For Bugs:** Describe the technical root cause and fix:
- What is causing the issue (not just symptoms)
- The specific code path or logic flaw
- The proposed fix with file paths

## Estimated Duration
[X] days (Target: YYYY-MM-DD)

## Acceptance Criteria
- [ ] Testable outcome 1
- [ ] Testable outcome 2
- [ ] Testable outcome 3

### 3. Time Estimation
Ask: "How long will this take?" and set target date accordingly.

### 4. Execution
./scripts/smart-ops.sh create "Title" "Body" "labels" [days]

### 5. Confirmation
Tell the user: issue created, start date (today), target date.
```

**B. Create `.agent/workflows/smart_complete.md`:**

```markdown
---
description: Intelligent end-of-work workflow that auto-detects what you completed
---
// turbo-all

# Workflow: Smart Complete (Intelligent)

## Usage
User: "Use /smart_complete. I finished [describe what you did]."

## Agent Steps

### 1. Scan Work (Scripted)
./scripts/smart-ops.sh complete

### 2. Match Work to Issues
Match user's completed work to active issues:
- If match found: Close issue, move to "Done"
- If partial work: Add comment, ask about status update

### 3. Duration Tracking
Calculate actual duration (start â†’ today) vs estimated (target date).
Report if early, on-time, or late.

### 4. Execution
./scripts/smart-ops.sh close <number> "Completed in X days"

### 5. Confirmation
Tell the user: issue closed, actual duration, variance from estimate.
```

## Agent Action
- Create `scripts/smart-ops.sh` with the detected config values
- Run `chmod +x scripts/smart-ops.sh` to make it executable
- Create the workflow files as described above
- Test with `./scripts/smart-ops.sh start`

## Stack Compatibility

| Stack | Works? | Notes |
|-------|--------|-------|
| Node.js/TypeScript | âœ… | Shell script works in any terminal |
| Python | âœ… | Shell script works |
| Rust | âœ… | Shell script works |
| Go | âœ… | Shell script works |
| Any Unix/Linux/macOS | âœ… | Native bash |
| Windows | âœ… | Works in Git Bash, WSL, or PowerShell with bash |

## Timeline Tracking Setup

To enable timeline tracking in GitHub Projects:

1. **Create Fields in GitHub Project:**
   - "Start Date" (Date type)
   - "Target Date" (Date type)

2. **Get Field IDs:**
   ```bash
   gh project field-list <PROJECT_NUMBER> --owner <OWNER> --format json
   ```

3. **Update Configuration:**
   Set `START_DATE_FIELD_ID` and `TARGET_DATE_FIELD_ID` in `smart-ops.sh`

4. **View Timeline:**
   In GitHub Projects, switch to "Roadmap" or "Timeline" view to see dates.

