# Workflow: Initialize Smart Ops (Ultimate)

This workflow bootstraps a production-grade automation suite for your repository. It detects your OS and generates native scripts for both PowerShell and Bash that handle Issue creation, Project Board management, and Timeline tracking.

## Phase 1: Context & Configuration

1. Detect Context

The agent verifies the repository details:

Bash

```
gh repo view --json owner,name,url
```

2. Fetch Project Board IDs (Optional but Recommended)

Ask user: "Are we using GitHub Projects for this repo?"

If **YES**, fetch the IDs. (This enables the timeline/status features).

Bash

```
# Get Project Number
gh project list --owner {{OWNER}} --format json

# Get Field Definitions (Status, Start Date, Target Date)
gh project field-list {{PROJECT_NUMBER}} --owner {{OWNER}} --format json
```

**Target Mapping:**

- `STATUS_FIELD` â†’ Todo / In Progress / Done IDs
    
- `START_DATE_FIELD` â†’ ID for "Start Date"
    
- `TARGET_DATE_FIELD` â†’ ID for "Target Date" or "Due Date"
    

---

## Phase 2: Generate Scripts

### ðŸ“„ Script 1: `scripts/smart-ops.ps1` (PowerShell - Enhanced)

_Best for: Windows Native, VS Code Integrated Terminal_

PowerShell

```
# Smart Ops - GitHub Automation (PowerShell)
# Generated by Smart Ops Ultimate

$ErrorActionPreference = "Stop"

# ============ CONFIGURATION ============
$REPO_OWNER = "{{OWNER}}"
$REPO_NAME = "{{REPO}}"
$REPO = "$REPO_OWNER/$REPO_NAME"

# Project Board Config (Empty strings if unused)
$PROJECT_NUMBER = "{{PROJECT_NUMBER}}"
$PROJECT_ID = "{{PROJECT_ID}}"
$STATUS_FIELD_ID = "{{STATUS_FIELD_ID}}"
$TODO_OPTION_ID = "{{TODO_OPTION_ID}}"
$IN_PROGRESS_OPTION_ID = "{{IN_PROGRESS_OPTION_ID}}"
$DONE_OPTION_ID = "{{DONE_OPTION_ID}}"
$START_DATE_FIELD_ID = "{{START_DATE_FIELD_ID}}"
$TARGET_DATE_FIELD_ID = "{{TARGET_DATE_FIELD_ID}}"

# ============ HELPERS ============
function Write-Status { param($Msg, $Color="Cyan") Write-Host ":: $Msg" -ForegroundColor $Color }
function Get-DateStr { return (Get-Date -Format "yyyy-MM-dd") }
function Get-FutureDate { param([int]$Days); return (Get-Date).AddDays($Days).ToString("yyyy-MM-dd") }

function Invoke-GH {
    param([string[]]$Args)
    try {
        $output = gh @Args 2>&1
        if ($LASTEXITCODE -ne 0) { throw "Exit code $LASTEXITCODE" }
        return $output
    } catch {
        Write-Host "Error running: gh $($Args -join ' ')" -ForegroundColor Red
        throw
    }
}

# ============ COMMANDS ============

function Start-Scan {
    Write-Status "Scanning Active Work..."
    Invoke-GH @("issue", "list", "--repo", $REPO, "--state", "open", "--json", "number,title,labels", "--limit", "20")
    
    if (-not [string]::IsNullOrEmpty($PROJECT_NUMBER)) {
        Write-Status "`nProject Board Items:"
        try { gh project item-list $PROJECT_NUMBER --owner $REPO_OWNER --format json --limit 20 2>$null } catch {}
    }
}

function New-Issue {
    param([string]$Title, [string]$Body, [string]$Labels="enhancement", [int]$Days=7)
    
    Write-Status "Creating: $Title (Est: ${Days}d)"
    $url = Invoke-GH @("issue", "create", "--repo", $REPO, "--title", $Title, "--body", $Body, "--label", $Labels)
    
    if ($url -match '/(\d+)$') {
        $num = $Matches[1]
        Write-Host "Created Issue #$num" -ForegroundColor Green
        
        # Project Board Integration
        if (-not [string]::IsNullOrEmpty($PROJECT_ID)) {
            Write-Status "Syncing to Project Board..." "Gray"
            try {
                $itemId = gh project item-add $PROJECT_NUMBER --owner $REPO_OWNER --url $url --jq '.id'
                
                # Set Dates
                if ($START_DATE_FIELD_ID) {
                    gh project item-edit --id $itemId --project-id $PROJECT_ID --field-id $START_DATE_FIELD_ID --date (Get-DateStr) 2>$null
                }
                if ($TARGET_DATE_FIELD_ID) {
                    gh project item-edit --id $itemId --project-id $PROJECT_ID --field-id $TARGET_DATE_FIELD_ID --date (Get-FutureDate $Days) 2>$null
                }
                Write-Host "Timeline Set: $(Get-DateStr) -> $(Get-FutureDate $Days)" -ForegroundColor Gray
            } catch {
                Write-Host "Warning: Could not sync to project board." -ForegroundColor Yellow
            }
        }
    }
}

function Close-Issue {
    param([string]$Num, [string]$Comment="Completed")
    $confirm = Read-Host "Close #$Num? (y/N)"
    if ($confirm -eq 'y') {
        Invoke-GH @("issue", "close", $Num, "--repo", $REPO, "--comment", $Comment)
        Write-Host "Closed #$Num" -ForegroundColor Green
    }
}

function Move-Progress {
    param([string]$Id)
    if ($PROJECT_ID -and $Id) {
        gh project item-edit --id $Id --field-id $STATUS_FIELD_ID --project-id $PROJECT_ID --single-select-option-id $IN_PROGRESS_OPTION_ID
        if ($START_DATE_FIELD_ID) {
            gh project item-edit --id $Id --project-id $PROJECT_ID --field-id $START_DATE_FIELD_ID --date (Get-DateStr) 2>$null
        }
        Write-Host "Moved to In Progress" -ForegroundColor Green
    }
}

function Move-Done {
    param([string]$Id)
    if ($PROJECT_ID -and $Id) {
        gh project item-edit --id $Id --field-id $STATUS_FIELD_ID --project-id $PROJECT_ID --single-select-option-id $DONE_OPTION_ID
        Write-Host "Moved to Done" -ForegroundColor Green
    }
}

# ============ ROUTING ============
$cmd = if ($args.Count -gt 0) { $args[0] } else { "help" }
switch ($cmd.ToLower()) {
    "start"    { Start-Scan }
    "complete" { Start-Scan; Write-Host "`nReady to close? Use: .\scripts\smart-ops.ps1 close <number>" }
    "create"   { New-Issue $args[1] $args[2] $args[3] ([int]$args[4]) }
    "close"    { Close-Issue $args[1] $args[2] }
    "progress" { Move-Progress $args[1] }
    "done"     { Move-Done $args[1] }
    default    { Write-Host "Commands: start, complete, create, close, progress, done" }
}
```

### ðŸ“„ Script 2: `scripts/smart-ops.sh` (Bash - Enhanced)

_Best for: WSL, Git Bash, macOS, Linux, CI/CD_

Bash

```
#!/bin/bash
# Smart Ops - GitHub Automation (Bash)
# Generated by Smart Ops Ultimate

set -e

# ============ CONFIGURATION ============
REPO_OWNER="{{OWNER}}"
REPO_NAME="{{REPO}}"
REPO="${REPO_OWNER}/${REPO_NAME}"

PROJECT_NUMBER="{{PROJECT_NUMBER}}"
PROJECT_ID="{{PROJECT_ID}}"
STATUS_FIELD_ID="{{STATUS_FIELD_ID}}"
TODO_OPTION_ID="{{TODO_OPTION_ID}}"
IN_PROGRESS_OPTION_ID="{{IN_PROGRESS_OPTION_ID}}"
DONE_OPTION_ID="{{DONE_OPTION_ID}}"
START_DATE_FIELD_ID="{{START_DATE_FIELD_ID}}"
TARGET_DATE_FIELD_ID="{{TARGET_DATE_FIELD_ID}}"

# ============ HELPERS ============
get_today() { date +%Y-%m-%d; }

get_future_date() {
    local days="${1:-7}"
    if [[ "$OSTYPE" == "darwin"* ]]; then
        date -v+${days}d +%Y-%m-%d
    else
        date -d "+${days} days" +%Y-%m-%d
    fi
}

# ============ COMMANDS ============

start() {
    echo "ðŸ” Scanning active work..."
    gh issue list --repo "$REPO" --state open --json number,title,labels --limit 20
    if [ -n "$PROJECT_NUMBER" ]; then
        echo ""
        gh project item-list "$PROJECT_NUMBER" --owner "$REPO_OWNER" --format json --limit 20 2>/dev/null || true
    fi
}

create_issue() {
    local title="$1"
    local body="$2"
    local labels="${3:-enhancement}"
    local days="${4:-7}"
    
    echo "ðŸ“ Creating: $title ($days days)"
    local url=$(gh issue create --repo "$REPO" --title "$title" --body "$body" --label "$labels")
    local num=$(echo "$url" | grep -oE '[0-9]+$')
    
    echo "âœ… Created #$num"
    
    if [ -n "$PROJECT_ID" ]; then
        local item_id=$(gh project item-add "$PROJECT_NUMBER" --owner "$REPO_OWNER" --url "$url" --jq '.id')
        
        [ -n "$START_DATE_FIELD_ID" ] && \
            gh project item-edit --id "$item_id" --project-id "$PROJECT_ID" --field-id "$START_DATE_FIELD_ID" --date "$(get_today)" 2>/dev/null
        
        [ -n "$TARGET_DATE_FIELD_ID" ] && \
            gh project item-edit --id "$item_id" --project-id "$PROJECT_ID" --field-id "$TARGET_DATE_FIELD_ID" --date "$(get_future_date "$days")" 2>/dev/null
            
        echo "ðŸ“… Timeline set"
    fi
}

close_issue() {
    local num="$1"
    local comment="${2:-Completed}"
    read -p "Close #$num? (y/N): " -n 1 -r; echo
    [[ $REPLY =~ ^[Yy]$ ]] && gh issue close "$num" --repo "$REPO" --comment "$comment" && echo "âœ… Closed #$num"
}

move_progress() {
    [ -n "$PROJECT_ID" ] && gh project item-edit --id "$1" --field-id "$STATUS_FIELD_ID" --project-id "$PROJECT_ID" --single-select-option-id "$IN_PROGRESS_OPTION_ID"
    [ -n "$START_DATE_FIELD_ID" ] && gh project item-edit --id "$1" --project-id "$PROJECT_ID" --field-id "$START_DATE_FIELD_ID" --date "$(get_today)" 2>/dev/null
    echo "â†’ In Progress"
}

move_done() {
    [ -n "$PROJECT_ID" ] && gh project item-edit --id "$1" --field-id "$STATUS_FIELD_ID" --project-id "$PROJECT_ID" --single-select-option-id "$DONE_OPTION_ID"
    echo "â†’ Done"
}

# ============ ROUTING ============
case "${1:-help}" in
    start) start ;;
    complete) start; echo ""; echo "Close with: ./scripts/smart-ops.sh close <number>" ;;
    create) create_issue "$2" "$3" "$4" "$5" ;;
    close) close_issue "$2" "$3" ;;
    progress) move_progress "$2" ;;
    done) move_done "$2" ;;
    *) echo "Usage: start, complete, create, close, progress, done" ;;
esac
```

---

## Phase 3: The Workflow Instructions

Create these files in `.agent/workflows/`. These instructions use the superior "Professional Template" from Workflow 2 but allow the Agent to pick the correct script (PS1 vs SH).

### ðŸ“„ `.agent/workflows/smart_start.md`

Markdown

```
---
description: Intelligent start-of-work workflow (Auto-detects OS & Context)
---
# Workflow: Smart Start

## Usage
User: "/smart_start I want to work on [description]"

## Agent Steps

### 1. Script Selection
- **Windows (PowerShell):** Use `.\scripts\smart-ops.ps1`
- **Linux/Mac/Git Bash:** Use `./scripts/smart-ops.sh`

### 2. Scan Work
Run the `start` command to see what is currently on the table.

### 3. Analyze & Template
If creating a **NEW** issue, strictly follow this template for the Body:

#### Title
[Feature/Bug] Clear summary

#### User Story
As a [user], I want [action], so that [benefit].

#### Technical Plan (Root Cause/Solution)
- **Files:** List files to be modified.
- **Logic:** Briefly explain the implementation path.

#### Acceptance Criteria
- [ ] Criteria 1
- [ ] Criteria 2

### 4. Execution
Ask the user for a time estimate (e.g., "3 days").
Run:
`.../smart-ops.[ps1|sh] create "Title" "Body" "Label" [Days]`

### 5. Report
Confirm issue creation, start date, and target deadline.
```

### ðŸ“„ `.agent/workflows/smart_complete.md`

Markdown

```
---
description: Intelligent completion workflow with timeline tracking
---
# Workflow: Smart Complete

## Usage
User: "/smart_complete I finished [description]"

## Agent Steps

### 1. Scan
Run the `complete` command via the appropriate script (`.ps1` or `.sh`).

### 2. Match
Identify the issue number that matches the user's description.

### 3. Execution
Run:
`.../smart-ops.[ps1|sh] close [Number] "Completed via Smart Ops"`

### 4. Project Cleanup (If using Projects)
If the user provides a Project Item ID, run:
`.../smart-ops.[ps1|sh] done [ItemID]`

### 5. Report
State that the issue is closed and logged as complete.
```